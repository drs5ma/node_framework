<html>

  <head>
    <style>
      body { margin: 0; }
      svg { width: 100%; height: 100% }
    </style>
  </head>
  <body>


    
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="Vector.js"></script>
    <script src="fire.js"></script>
    <script src="mask.js"></script>
    <script src="stats.min.js"></script>

    <script src="fixed.snap.svg.js"></script>
    <script src="client.js"></script>



<script>


function move(obj, vector){
      obj.attr({cx:parseFloat(me.attr("cx"))+vector[0]});
      obj.attr({cy:parseFloat(me.attr("cy"))+vector[1]});
     };

function calc_viewbox(pos, size){
      var uppleft = [  pos[0]-(size[0]/2.0) , pos[1]-(size[1]/2.0)   ];
      var arr = [uppleft[0], uppleft[1], size[0], size[1]];
      return arr;
    };

function format_viewbox(arr){
      return arr.join(" ");
    };


function isInside(point, bbox){
      var x = bbox[0];
      var y = bbox[1];
      var width = bbox[2];
      var height = bbox[3];

      if( point[0] < x || point[1] < y || point[0] > x+width || point[1] > y+height ){
        return false;
      }
      return true;

    }

function centerof_bbox(bbox){
  var x = bbox[0];
  var y = bbox[1];
  var width = bbox[2];
  var height = bbox[3];
  return [  x+(width/2.0) , 
            y+(height/2.0) ];

}

//ratio = 1.5 times bigger with same center
function larger_bbox(bbox, ratio){

  var x = bbox[0];
  var y = bbox[1];
  var width = bbox[2];
  var height = bbox[3];

  var [cx,cy] = centerof_bbox(bbox);
  var rw = ratio*width;
  var rh = ratio*height;
  return [ cx - (rw/2.0), cy - (rh/2.0) , rw, rh ];

}

    //globals
    //width, height, paper, camera_position
    //aspect_ratio, sizeofview, vb, buffer_vb
    //me, circle, tree
    var width =  window.innerWidth;
    var height = window.innerHeight;
    window.addEventListener('keydown', handleKeyDown, false);
    window.addEventListener('keyup', handleKeyUp, false);
    var paper = Snap(5000,5000); //world map
    paper.attr('preserveAspectRatio', 'none');
    paper.attr({id: "svg1"});
    paper.attr({
      width: String(width)+'px',
      height: String(height)+'px'
    });
    var camera_position = [ 250,250 ];
    var aspect_ratio = width/height;
    $(window).on('resize', function(){
            width =  window.innerWidth;
            height = window.innerHeight;
            aspect_ratio = width/height;   
    });
    var sizeofview = [ 500,500 ];
    if(width >= height){
        sizeofview[0] *= aspect_ratio;
    }
    else{
        sizeofview[1] /= aspect_ratio;
    }
    var vb  = calc_viewbox( camera_position, sizeofview  );
    var buffer_vb =  larger_bbox(vb,1.5);
    paper.attr({
        viewBox: format_viewbox(vb)
    });//player view

    //draw objects
    var circle = paper.circle(0,0,200);
    circle.attr({fill:"orange", opacity:0.24});
    var tree = paper.path('M0,0L10,30L90,45L0,0').attr({fill:'green', stroke:'black', strokeWidth:3});
    tree.transform( 't100,100');
    var me = paper.circle( camera_position[0] , camera_position[1] , 24).attr({fill:"black"});
    me.speed = 0.15; //pixels per second









    //on screen click...
    paper.click(function(evt){
          var xratio = evt.pageX/width;
          var yratio = evt.pageY/height;
          var clickpos = [ vb[0]+(xratio*vb[2]) , vb[1]+(yratio*vb[3])  ] ;
          var mepos = [parseFloat(me.attr("cx")) , parseFloat(me.attr("cy"))];
          var x1 = clickpos[0];
          var y1 = clickpos[1];
          var x2 = mepos[0];
          var y2 = mepos[1];
          var d = Math.sqrt( (x1-x2)*(x1-x2) + (y1-y2)*(y1-y2) );
          me.animate( {cx: clickpos[0] , cy: clickpos[1] } , d / me.speed, mina.linear);
    });

    
        function movecameraonce(){
                var viewchange = 100;
                //var oldpos =  [camera_position[0], camera_position[1]];
                if(window.isWDown ){
                    camera_position[1] -= viewchange;}
                if(window.isSDown ){
                    camera_position[1] += viewchange;}
                if(window.isADown ){
                    camera_position[0] -= viewchange;}
                if(window.isDDown ){
                    camera_position[0] += viewchange;}
                //var mypos = [me.attr('cx'),me.attr('cy')];
                vb  = calc_viewbox( camera_position, sizeofview );
                paper.animate({viewBox: format_viewbox(vb) }, 480, mina.easein, function(){});
        }


    function handleKeyDown(event) {
        // var viewchange = 100;
        if (event.keyCode === 87) { //66 is "b"
          window.isWDown = true;
          // camera_position[1] -= viewchange;
        }
        if (event.keyCode === 65) { //66 is "b"
          window.isADown = true;
          // camera_position[0] -= viewchange;
        }
        if (event.keyCode === 83) { //66 is "b"
          window.isSDown = true;
          // camera_position[1] += viewchange;
        }
        if (event.keyCode === 68) { //66 is "b"
          window.isDDown = true;
          // camera_position[0] += viewchange;}
        }
        movecameraonce();
        //beginFunction();

      };
    function handleKeyUp(event) {
        if (event.keyCode === 87) {
          window.isWDown = false;
        }
        if (event.keyCode === 65) {
          window.isADown = false;
        }
        if (event.keyCode === 83) {
          window.isSDown = false;
         }
        if (event.keyCode === 68) {
          window.isDDown = false;
        }
        //endFunction();
      };


//var m = new tricircle2(parseFloat(me.attr('cx')),parseFloat(me.attr('cy')),100);

//var n = new screenFire();
// n.init(100);
//n.endme();



    




</script>



  </body>
</html>
